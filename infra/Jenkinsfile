pipeline {
  agent any

  environment {
    TF_DIR = "infra/terraform"
  }

  stages {
    stage('Init & Plan') {
      steps {
        dir("${TF_DIR}") {
          // Clean existing plugin cache and re-init Terraform
          sh '''
            rm -rf .terraform
            terraform init
            terraform plan -var-file="terraform.tfvars"
          '''
        }
      }
    }
  }
}
